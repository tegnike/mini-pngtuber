# PNGTuber Simple

![PNGTuber Simple](public/readme_image.png)

マイク入力を使って、キャラクター画像の口と目を自動で切り替える PNGTuber アプリです。瞬き機能も搭載しており、配信やビデオ通話でアバターとして使用できます。

## 起動方法

### Electron アプリとして起動（推奨）

```bash
# 依存関係のインストール（初回のみ）
npm install

# アプリを起動
npm run electron

# 開発モード（DevTools表示）
npm run electron:dev
```

### ブラウザ版として起動

```bash
# サーバー起動
npm start
# または
node server.js

# ブラウザで http://localhost:3000 にアクセス
```

### ビルド（配布用）

```bash
# macOS用
npm run build:mac

# Windows用
npm run build:win

# Linux用
npm run build:linux
```

## 設定項目

設定パネルは右上の歯車アイコンから開けます。

### マイク設定

| 項目 | 説明 |
|------|------|
| **入力デバイス** | 使用するマイクを選択します。「デバイス更新」で一覧を再取得できます。 |
| **感度（しきい値）** | 口を開く判定の音量しきい値（0〜1.00）。値が小さいほど小さな声でも反応します。 |
| **切り替え間隔** | 口の開閉状態を切り替える最小間隔（秒）。パタパタ切り替わるのを防ぎます。 |
| **スムージング** | 音量の変化を滑らかにします（0〜0.95）。値が大きいほど安定しますが、反応が遅くなります。 |
| **入力ゲイン** | マイク入力を増幅します（0.5x〜6.0x）。マイクが小さい場合に上げてください。 |
| **発話検出遅延** | 閾値を超えてから口を開くまでの遅延時間（0〜0.5秒）。吐息やタイピング音などの短い雑音を無視できます。デフォルトは0.2秒。 |

### 表示設定

| 項目 | 説明 |
|------|------|
| **表示サイズ** | キャラクター画像の表示サイズ（25%〜200%）。 |
| **背景色** | ウィンドウの背景色。OBSでクロマキー合成する場合は緑（#00FF00）などに設定。 |
| **音量メーター表示** | 画面下部の音量メーターの表示/非表示を切り替えます。 |

### 画像設定

| 項目 | 説明 |
|------|------|
| **口閉じ×目開き** | 通常状態（黙っている時）の画像。 |
| **口閉じ×目閉じ** | 瞬き時の画像。 |
| **口開き×目開き** | 話している時の画像。 |
| **口開き×目閉じ** | 話しながら瞬きしている時の画像。 |

### 瞬き設定

| 項目 | 説明 |
|------|------|
| **瞬き機能** | ON/OFFで瞬き機能を切り替えます。 |
| **瞬き間隔（最小）** | 瞬きが発生する最短間隔（秒）。 |
| **瞬き間隔（最大）** | 瞬きが発生する最長間隔（秒）。この範囲内でランダムに瞬きします。 |
| **瞬き時間** | 目を閉じている時間（ミリ秒）。50〜300msで調整。 |

## 画像の配置

`public/` フォルダに4枚の画像を配置してください。

```
public/
├── closed_eyes_open.png    # 口閉じ×目開き（通常）
├── closed_eyes_closed.png  # 口閉じ×目閉じ（瞬き）
├── open_eyes_open.png      # 口開き×目開き（発話中）
└── open_eyes_closed.png    # 口開き×目閉じ（発話中の瞬き）
```

対応フォーマット: PNG, JPG, JPEG, GIF, WebP, SVG

## 調整のコツ

- **口が開きっぱなしになる**: 感度（しきい値）を上げる
- **口が反応しない**: 感度を下げるか、入力ゲインを上げる
- **パタパタ頻繁に切り替わる**: スムージングを上げるか、切り替え間隔を長くする
- **吐息やタイピング音に反応する**: 発話検出遅延を上げる（0.2〜0.3秒推奨）
- **瞬きが不自然**: 瞬き間隔と瞬き時間を調整（人間は平均3〜4秒間隔、150ms程度）

## 設定の保存

すべての設定はローカルストレージに自動保存され、次回起動時に復元されます。

## 技術仕様

- Electron ベースのデスクトップアプリ
- Web Audio API による音声解析
- RMS（二乗平均平方根）で音量を算出
- macOS では hiddenInset タイトルバーを使用

## ライセンス

MIT License

---

不明点や追加要望があればお知らせください。
